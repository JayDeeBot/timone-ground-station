<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TimoneGUI - {% block title %}{% endblock %}</title>

  <!-- PWA: manifest + theme color -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0d6efd">

  <!-- Favicon -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

  <!-- Local vendor CSS (offline-first) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap-5.3.0/css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/leaflet-1.7.1/leaflet.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap-icons-1.7.2/bootstrap-icons.css') }}">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
  {% include 'components/navbar.html' %}

  <div class="container-fluid">
    {% block content %}{% endblock %}
  </div>

  <!-- Local vendor JS (offline-first) -->
  <script src="{{ url_for('static', filename='vendor/chart.js-4/chart.umd.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/bootstrap-5.3.0/js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/leaflet-1.7.1/leaflet.js') }}"></script>

  <!-- Custom JS -->
  <script src="{{ url_for('static', filename='js/graph-interactions.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/historical.js') }}"></script>
  <script src="{{ url_for('static', filename='js/maps.js') }}"></script>
  <script src="{{ url_for('static', filename='js/logs.js') }}"></script>
  <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
  <script src="{{ url_for('static', filename='js/telemetry.js') }}"></script>

  <!-- Optional: CDN fallbacks if a local vendor file fails to load -->
  <script>
    (function fallbackVendors(){
      function injectJS(src){
        var s=document.createElement('script');
        s.src=src; s.defer=false; document.head.appendChild(s);
      }
      function hasChart(){ return typeof window.Chart !== 'undefined'; }
      function hasLeaflet(){ return typeof window.L !== 'undefined'; }
      function hasBootstrap(){ return typeof window.bootstrap !== 'undefined'; }

      if (!hasChart())     injectJS('https://cdn.jsdelivr.net/npm/chart.js');
      if (!hasBootstrap()) injectJS('https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js');
      if (!hasLeaflet())   injectJS('https://unpkg.com/leaflet@1.7.1/dist/leaflet.js');
    })();
  </script>

  <!-- Register service worker (root scope so it controls all pages) -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(console.error);
    }
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
